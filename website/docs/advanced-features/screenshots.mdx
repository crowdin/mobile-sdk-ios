import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';

# Screenshots

Enable this option if you want all screenshots taken in the application to be automatically sent to your Crowdin project with tagged strings. This provides additional context for translators.

## Setup

### Swift

Add the code below to your *Podfile*:

```swift title="Podfile"
use_frameworks!
target 'your-app' do
    pod 'CrowdinSDK'
    pod 'CrowdinSDK/LoginFeature' // Required for Screenshots
    pod 'CrowdinSDK/Screenshots' // Required for Screenshots
    pod 'CrowdinSDK/Settings' // Optional. To add 'settings' button
end
```

Open *AppDelegate.swift* file and in the `application` method add:

```swift title="AppDelegate.swift"
let crowdinProviderConfig = CrowdinProviderConfig(hashString: "{your_distribution_hash}",
    sourceLanguage: "{source_language}",
    organizationName: "{organization_name}") // Optional. Required for Enterprise only

// Option 1: Access Token Authentication (Recommended for simplicity)
let crowdinSDKConfig = CrowdinSDKConfig.config()
    .with(crowdinProviderConfig: crowdinProviderConfig)
    .with(screenshotsEnabled: true)
    .with(accessToken: "your_access_token")
    .with(settingsEnabled: true)

// OR Option 2: OAuth Authentication
var loginConfig: CrowdinLoginConfig
do {
   loginConfig = try CrowdinLoginConfig(clientId: "{client_id}",
       clientSecret: "{client_secret}",
       scope: "project.screenshot",
       redirectURI: "{redirectURI}")
} catch {
    print(error)
    // CrowdinLoginConfig initialization error handling, typically for empty values and for wrong redirect URI value.
}

let crowdinSDKConfig = CrowdinSDKConfig.config()
    .with(crowdinProviderConfig: crowdinProviderConfig)
    .with(screenshotsEnabled: true)
    .with(loginConfig: loginConfig)
    .with(settingsEnabled: true)

CrowdinSDK.startWithConfig(crowdinSDKConfig, completion: {
    // SDK is ready to use, put code to change language, etc. here
})
```

### Objective-C

```objectivec
CrowdinProviderConfig *crowdinProviderConfig = [[CrowdinProviderConfig alloc] initWithHashString:@"" sourceLanguage:@"" organizationName:@"{organization_name}"];

// Option 1: Access Token Authentication (Recommended for simplicity)
CrowdinSDKConfig *config = [[[[CrowdinSDKConfig config] 
    withCrowdinProviderConfig:crowdinProviderConfig]
    withScreenshotsEnabled:YES]
    withAccessToken:@"your_access_token"];

// OR Option 2: OAuth Authentication
NSError *error;
CrowdinLoginConfig *loginConfig = [[CrowdinLoginConfig alloc] 
    initWithClientId:@"{client_id}" 
    clientSecret:@"{client_secret}" 
    scope:@"project.screenshot" 
    error:&error];

if (!error) {
    CrowdinSDKConfig *config = [[[[CrowdinSDKConfig config]
        withCrowdinProviderConfig:crowdinProviderConfig]
        withScreenshotsEnabled:YES]
        withLoginConfig:loginConfig];

    [CrowdinSDK startWithConfig:config completion:^{
        // SDK is ready to use, put code to change language, etc. here
    }];
} else {
    NSLog(@"%@", error.localizedDescription);
    // CrowdinLoginConfig initialization error handling, typically for empty values and for wrong redirect URI value.
}
```

### Authorization

The Screenshots feature requires Crowdin authorization. You can use either Access Token or OAuth authentication. If both methods are configured, access token authentication takes priority.

For OAuth authentication, you need to handle authorization callback in your application:

import authCallbackSwift from '!!raw-loader!../code-samples/auth-callback.swift';
import authCallbackObjectiveC from '!!raw-loader!../code-samples/auth-callback.m';

<Tabs groupId="language">
  <TabItem value="swift" label="Swift"><CodeBlock language="swift">{authCallbackSwift}</CodeBlock></TabItem>
  <TabItem value="obj-c" label="Objective-C"><CodeBlock language="objectivec">{authCallbackObjectiveC}</CodeBlock></TabItem>
</Tabs>

If you are using **SceneDelegate**, you need to handle callback in the **SceneDelegate** class implement method:

import sceneDelegateCallbackSwift from '!!raw-loader!../code-samples/scene-delegate-callback.swift';
import sceneDelegateCallbackObjectiveC from '!!raw-loader!../code-samples/scene-delegate-callback.m';

<Tabs groupId="language">
  <TabItem value="swift" label="Swift"><CodeBlock language="swift">{sceneDelegateCallbackSwift}</CodeBlock></TabItem>
  <TabItem value="obj-c" label="Objective-C"><CodeBlock language="objectivec">{sceneDelegateCallbackObjectiveC}</CodeBlock></TabItem>
</Tabs>

### Custom Screenshot Handler

You can use one of two methods to take screenshots programmatically:

1. Basic screenshot capture:
```swift
CrowdinSDK.captureScreenshot(name: String(Date().timeIntervalSince1970)) {
    print("Screenshot captured")
} errorHandler: { error in
    print("Screenshot capture failed with error - " + (error?.localizedDescription ?? ""))
}
```

2. Capture and update existing screenshot:
```swift

CrowdinSDK.captureAndUpdateScreenshot(name: "{screenshot_name}") { result in
    switch result {
        case .new: print("New screenshot captured")
        case .udpated: print("Screenshot updated")
    }
} errorHandler: { error in
    print("Error: \(error)")
}
```

The `captureAndUpdateScreenshot` method is useful when you want to update an existing screenshot in your Crowdin project. This can help maintain screenshot organization by updating existing screenshots rather than creating new ones each time.

You can also capture screenshots of specific UIView instances with either method.

:::caution
The Screenshots feature should not be used in a production environment. It is intended for use in development or staging only.
:::

## Troubleshooting

If you get the error:
> Error while capturing screenshot - The operation couldn't be completed. (There are no localized strings detected on current screen. error 99999.)

Make sure that your **current locale** matches your project's **source (default) language**.

## Config Options Reference

| Option                | Description                                          | Required | Example                                |
|----------------------|------------------------------------------------------|----------|----------------------------------------|
| `hashString`         | Distribution Hash                                    | Yes      | `hashString: "7a0c1...o3b"`           |
| `sourceLanguage`     | Source language code ([ISO 639-1](http://www.loc.gov/standards/iso639-2/php/English_list.php)) | Yes | `sourceLanguage: "en"`            |
| `organizationName`   | Organization domain (Enterprise only)                | No       | `organizationName: "mycompany"`        |
| `settingsEnabled`    | Enable SDK Controls                                  | No       | `settingsEnabled: true`                |
| `screenshotsEnabled` | Enable Screenshots feature                          | Yes      | `screenshotsEnabled: true`             |
| `accessToken`        | Crowdin API access token                            | No*      | `accessToken: "your_token"`            |

*Either `accessToken` or OAuth configuration is required.

### OAuth Options
| Option           | Description                                          | Required | Example                            |
|------------------|------------------------------------------------------|----------|-----------------------------------|
| `clientId`       | OAuth Client ID                                      | Yes*     | `clientId: "gpY2yT...x3TYB"`      |
| `clientSecret`   | OAuth Client Secret                                  | Yes*     | `clientSecret: "Xz95t...EDx9T"`   |
| `scope`          | OAuth scope (must include "project.screenshot")      | Yes*     | `scope: "project.screenshot"`      |
| `redirectURI`    | Custom URL scheme for your app                       | No       | `redirectURI: "crowdintest://"`   |

*Required only if using OAuth authentication instead of access token.
